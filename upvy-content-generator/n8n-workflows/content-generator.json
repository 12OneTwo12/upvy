{
  "id": "upvy-ai-content-generator",
  "name": "Upvy AI Content Generator",
  "nodes": [
    {
      "parameters": {
        "formTitle": "AI Content Generator",
        "formDescription": "Generate educational short-form video content",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Language",
              "fieldType": "dropdown",
              "requiredField": true,
              "fieldOptions": {
                "values": [
                  { "option": "English", "value": "en" },
                  { "option": "Korean", "value": "ko" },
                  { "option": "Japanese", "value": "ja" }
                ]
              }
            },
            {
              "fieldLabel": "Category",
              "fieldType": "dropdown",
              "requiredField": true,
              "fieldOptions": {
                "values": [
                  { "option": "ðŸŽ² Random", "value": "" },
                  { "option": "ðŸ’» Programming", "value": "PROGRAMMING" },
                  { "option": "ðŸ”¬ Science", "value": "SCIENCE" },
                  { "option": "ðŸŒ Language", "value": "LANGUAGE" },
                  { "option": "ðŸ“œ History", "value": "HISTORY" },
                  { "option": "ðŸ“ Mathematics", "value": "MATHEMATICS" },
                  { "option": "ðŸŽ¨ Art", "value": "ART" },
                  { "option": "ðŸš€ Startup", "value": "STARTUP" },
                  { "option": "ðŸ“¢ Marketing", "value": "MARKETING" },
                  { "option": "ðŸŽ¯ Design", "value": "DESIGN" },
                  { "option": "â° Productivity", "value": "PRODUCTIVITY" },
                  { "option": "ðŸ§  Psychology", "value": "PSYCHOLOGY" },
                  { "option": "ðŸ’° Finance", "value": "FINANCE" },
                  { "option": "â¤ï¸ Health", "value": "HEALTH" },
                  { "option": "ðŸ”¥ Motivation", "value": "MOTIVATION" },
                  { "option": "ðŸ‘¶ Parenting", "value": "PARENTING" },
                  { "option": "ðŸ³ Cooking", "value": "COOKING" },
                  { "option": "âœˆï¸ Travel", "value": "TRAVEL" },
                  { "option": "ðŸŽ® Hobby", "value": "HOBBY" },
                  { "option": "ðŸ“ˆ Trend", "value": "TREND" }
                ]
              }
            },
            {
              "fieldLabel": "Difficulty",
              "fieldType": "dropdown",
              "requiredField": true,
              "fieldOptions": {
                "values": [
                  { "option": "ðŸŽ² Random", "value": "" },
                  { "option": "Beginner", "value": "BEGINNER" },
                  { "option": "Intermediate", "value": "INTERMEDIATE" },
                  { "option": "Advanced", "value": "ADVANCED" }
                ]
              }
            },
            {
              "fieldLabel": "Output Type",
              "fieldType": "dropdown",
              "requiredField": true,
              "fieldOptions": {
                "values": [
                  { "option": "ðŸ–¼ï¸ Images Only (Recommended)", "value": "images_only" },
                  { "option": "ðŸŽ¬ AI Video (Veo)", "value": "ai_video" }
                ]
              }
            }
          ]
        },
        "options": {}
      },
      "id": "form-trigger",
      "name": "Manual Form",
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.2,
      "position": [-200, 200],
      "webhookId": "upvy-manual-gen"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            { "triggerAtHour": 6 },
            { "triggerAtHour": 9 },
            { "triggerAtHour": 12 },
            { "triggerAtHour": 15 },
            { "triggerAtHour": 18 }
          ]
        }
      },
      "id": "trigger-en",
      "name": "Schedule EN (5/day)",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [-200, 400]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            { "triggerAtHour": 7 },
            { "triggerAtHour": 13 },
            { "triggerAtHour": 19 }
          ]
        }
      },
      "id": "trigger-ko",
      "name": "Schedule KO (3/day)",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [-200, 600]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            { "triggerAtHour": 8 },
            { "triggerAtHour": 14 },
            { "triggerAtHour": 20 }
          ]
        }
      },
      "id": "trigger-ja",
      "name": "Schedule JA (3/day)",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [-200, 800]
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json;\nconst crypto = require('crypto');\n\n// All 19 categories\nconst categories = ['PROGRAMMING', 'SCIENCE', 'LANGUAGE', 'HISTORY', 'MATHEMATICS', 'ART', 'STARTUP', 'MARKETING', 'DESIGN', 'PRODUCTIVITY', 'PSYCHOLOGY', 'FINANCE', 'HEALTH', 'MOTIVATION', 'PARENTING', 'COOKING', 'TRAVEL', 'HOBBY', 'TREND'];\nconst difficulties = ['BEGINNER', 'INTERMEDIATE', 'ADVANCED'];\n\n// Extract from form or use defaults\nconst language = input.Language || input.language || 'en';\nconst categoryInput = input.Category || input.category || '';\nconst difficultyInput = input.Difficulty || input.difficulty || '';\nconst outputType = input['Output Type'] || input.outputType || 'images_only';\n\n// Randomize if empty\nconst category = (categoryInput && categoryInput.trim() !== '') \n  ? categoryInput \n  : categories[Math.floor(Math.random() * categories.length)];\nconst difficulty = (difficultyInput && difficultyInput.trim() !== '') \n  ? difficultyInput \n  : difficulties[Math.floor(Math.random() * difficulties.length)];\n\nconst jobId = `${new Date().toISOString().replace(/[-:T.Z]/g, '').slice(0, 14)}-${crypto.randomUUID().slice(0, 8)}`;\n\nreturn {\n  json: {\n    language,\n    category,\n    difficulty,\n    outputType,\n    jobId\n  }\n};"
      },
      "id": "set-config",
      "name": "Set Config",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [100, 200]
    },
    {
      "parameters": {
        "mode": "manual",
        "fields": {
          "values": [
            { "name": "language", "stringValue": "en" }
          ]
        },
        "options": { "include": "all" }
      },
      "id": "set-lang-en",
      "name": "Set EN",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [100, 400]
    },
    {
      "parameters": {
        "mode": "manual",
        "fields": {
          "values": [
            { "name": "language", "stringValue": "ko" }
          ]
        },
        "options": { "include": "all" }
      },
      "id": "set-lang-ko",
      "name": "Set KO",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [100, 600]
    },
    {
      "parameters": {
        "mode": "manual",
        "fields": {
          "values": [
            { "name": "language", "stringValue": "ja" }
          ]
        },
        "options": { "include": "all" }
      },
      "id": "set-lang-ja",
      "name": "Set JA",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [100, 800]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key={{ $env.GEMINI_API_KEY }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ contents: [{ parts: [{ text: `You are an educational content planner.\n\n[Task]\n1. Search for trending educational topics in the \"${$json.category}\" field\n2. Suggest 3 topics suitable for short-form videos (30-60 seconds)\n3. Evaluate viral potential and educational value for each\n\nDifficulty: ${$json.difficulty}\n\n**IMPORTANT: Generate ALL content (titles, hooks, key points) in ${$json.language === 'ko' ? 'Korean' : ($json.language === 'ja' ? 'Japanese' : 'English')} language.**\n\n[Output format - JSON only]\n{\n  \"topics\": [\n    {\n      \"title\": \"Topic title in target language\",\n      \"hook\": \"Attention-grabbing first sentence in target language\",\n      \"keyPoints\": [\"Point 1\", \"Point 2\", \"Point 3\"],\n      \"viralScore\": 85,\n      \"educationalScore\": 90\n    }\n  ]\n}` }] }], generationConfig: { temperature: 0.7, maxOutputTokens: 2048 } }) }}",
        "options": {}
      },
      "id": "topic-select",
      "name": "1. Topic Select",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [400, 200]
    },
    {
      "parameters": {
        "jsCode": "const response = $input.first().json;\nconst prevContext = $('Set Config').first().json;\n\n// Gemini API ì‘ë‹µì—ì„œ í…ìŠ¤íŠ¸ ì¶”ì¶œ\nlet text = response.candidates?.[0]?.content?.parts?.[0]?.text || '';\nif (!text) throw new Error('No text in Gemini response');\n\n// JSON ì¶”ì¶œ\nlet jsonStr = text.replace(/```json\\n?/g, '').replace(/```\\n?/g, '');\nconst firstBrace = jsonStr.indexOf('{');\nconst lastBrace = jsonStr.lastIndexOf('}');\nif (firstBrace !== -1 && lastBrace !== -1) {\n  jsonStr = jsonStr.substring(firstBrace, lastBrace + 1);\n}\n\ntry {\n  const parsed = JSON.parse(jsonStr);\n  const topics = parsed.topics || [];\n  const bestTopic = topics.sort((a, b) => \n    (b.viralScore + b.educationalScore) - (a.viralScore + a.educationalScore)\n  )[0];\n  \n  if (!bestTopic) throw new Error('No topics found');\n  \n  return { json: { ...prevContext, selectedTopic: bestTopic, allTopics: topics } };\n} catch (e) {\n  throw new Error(`Topic parsing failed: ${e.message}\\nRaw: ${text.substring(0, 500)}`);\n}"
      },
      "id": "parse-topic",
      "name": "Parse Topic",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [620, 200]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key={{ $env.GEMINI_API_KEY }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ contents: [{ parts: [{ text: `You are a professional educational short-form content creator for TikTok/YouTube Shorts.\nCreate a 60-second vertical (9:16) video script with PROFESSIONAL SUBTITLES and quiz.\n\n=== Script Rules ===\nCreate EXACTLY 5 sections with DIFFERENT visual scenes:\n1. HOOK (0-5s): Attention-grabbing question or surprising fact\n2. CORE_1 (5-20s): First key point with specific example\n3. CORE_2 (20-35s): Second key point with demonstration\n4. CORE_3 (35-50s): Third key point with real-world application\n5. CTA (50-60s): Call to action and summary\n\n=== SUBTITLE RULES (CRITICAL) ===\nEach section MUST include a 'subtitles' array with SHORT, TIMED text chunks:\n- Each subtitle: 2-3 seconds duration\n- Each subtitle: MAX 25 characters (Korean/Japanese) or 40 characters (English)\n- MAX 2 lines per subtitle\n\n=== Visual Cue Rules ===\nEach section MUST have a COMPLETELY DIFFERENT visualCue:\n- A realistic, photographic scene\n- Professional educational style\n\n=== Quiz Rules ===\n1. One question testing the core concept\n2. 4 options (1 correct + 3 incorrect)\n\n[Topic Info]\nTitle: ${$json.selectedTopic.title}\nHook: ${$json.selectedTopic.hook}\nKey Points: ${$json.selectedTopic.keyPoints.join(', ')}\nDifficulty: ${$json.difficulty}\n\n**CRITICAL: Write ALL content in ${$json.language === 'ko' ? 'Korean' : ($json.language === 'ja' ? 'Japanese' : 'English')}.**\n\n[Output format - JSON only]\n{\n  \"script\": {\n    \"title\": \"Video title\",\n    \"description\": \"Video description (200 chars)\",\n    \"totalDuration\": 60,\n    \"sections\": [\n      {\n        \"type\": \"HOOK\",\n        \"startTime\": 0,\n        \"endTime\": 5,\n        \"narration\": \"Full narration text for TTS\",\n        \"subtitles\": [\n          {\"start\": 0, \"end\": 2.5, \"text\": \"First subtitle chunk\"},\n          {\"start\": 2.5, \"end\": 5, \"text\": \"Second subtitle chunk\"}\n        ],\n        \"visualCue\": \"Realistic photo description\"\n      }\n    ],\n    \"tags\": [\"tag1\", \"tag2\"]\n  },\n  \"quiz\": {\n    \"question\": \"Quiz question\",\n    \"options\": [\n      {\"text\": \"Option 1\", \"isCorrect\": true},\n      {\"text\": \"Option 2\", \"isCorrect\": false},\n      {\"text\": \"Option 3\", \"isCorrect\": false},\n      {\"text\": \"Option 4\", \"isCorrect\": false}\n    ]\n  },\n  \"qualityCheck\": {\n    \"verdict\": \"PASS\",\n    \"reason\": \"Quality review reason\"\n  }\n}` }] }], generationConfig: { temperature: 0.8, maxOutputTokens: 8192 } }) }}",
        "options": {}
      },
      "id": "script-gen",
      "name": "2. Script + Quiz Gen",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [840, 200]
    },
    {
      "parameters": {
        "jsCode": "const response = $input.first().json;\nconst prevContext = $('Parse Topic').first().json;\n\n// Gemini API ì‘ë‹µì—ì„œ í…ìŠ¤íŠ¸ ì¶”ì¶œ\nlet text = response.candidates?.[0]?.content?.parts?.[0]?.text || '';\nif (!text) throw new Error('No text in Gemini response');\n\n// JSON ì¶”ì¶œ\nlet jsonStr = text.replace(/```json\\n?/g, '').replace(/```\\n?/g, '');\nconst firstBrace = jsonStr.indexOf('{');\nconst lastBrace = jsonStr.lastIndexOf('}');\nif (firstBrace !== -1 && lastBrace !== -1) {\n  jsonStr = jsonStr.substring(firstBrace, lastBrace + 1);\n}\n\ntry {\n  const parsed = JSON.parse(jsonStr);\n  if (!parsed.script || !parsed.quiz || !parsed.qualityCheck) throw new Error('Missing required fields');\n  \n  return {\n    json: {\n      ...prevContext,\n      script: parsed.script,\n      quiz: parsed.quiz,\n      qualityCheck: parsed.qualityCheck,\n      totalDuration: parsed.script.totalDuration || 60\n    }\n  };\n} catch (e) {\n  throw new Error(`Script parsing failed: ${e.message}\\nRaw: ${text.substring(0, 500)}`);\n}"
      },
      "id": "parse-script",
      "name": "Parse Script + Quiz",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1060, 200]
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" },
          "conditions": [
            {
              "id": "quality-check",
              "leftValue": "={{ $json.qualityCheck.verdict }}",
              "rightValue": "PASS",
              "operator": { "type": "string", "operation": "equals" }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "quality-gate",
      "name": "3. Quality Gate",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1280, 200]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" },
                "conditions": [
                  { "leftValue": "={{ $json.outputType }}", "rightValue": "ai_video", "operator": { "type": "string", "operation": "equals" } }
                ]
              },
              "renameOutput": true,
              "outputKey": "ai_video"
            },
            {
              "conditions": {
                "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" },
                "conditions": [
                  { "leftValue": "={{ $json.outputType }}", "rightValue": "images_only", "operator": { "type": "string", "operation": "equals" } }
                ]
              },
              "renameOutput": true,
              "outputKey": "images_only"
            }
          ]
        },
        "options": { "fallbackOutput": "extra" }
      },
      "id": "output-switch",
      "name": "Output Type Switch",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [1500, 100]
    },
    {
      "parameters": {
        "jsCode": "const prevContext = $input.first().json;\nconst sections = prevContext.script.sections || [];\n\nconst items = sections.map((section, index) => {\n  const visualCue = section.visualCue || `Educational image about ${prevContext.category}`;\n  const prompt = `Professional educational photograph: ${visualCue}. High-quality, photorealistic style. Clean composition, professional lighting. Vertical 9:16 format. NO cartoon, NO illustration, NO text, NO watermarks.`;\n  \n  return {\n    json: {\n      sectionIndex: index,\n      sectionType: section.type,\n      startTime: section.startTime,\n      endTime: section.endTime,\n      duration: section.endTime - section.startTime,\n      imagePrompt: prompt,\n      _context: prevContext\n    }\n  };\n});\n\nreturn items;"
      },
      "id": "prepare-image-requests",
      "name": "4a. Prepare Images",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1720, 200]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key={{ $env.GEMINI_API_KEY }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ instances: [{ prompt: $json.imagePrompt }], parameters: { sampleCount: 1, aspectRatio: '9:16', safetyFilterLevel: 'block_only_high', personGeneration: 'allow_adult' } }) }}",
        "options": {
          "batching": { "batch": { "batchSize": 1, "batchInterval": 5000 } },
          "retry": { "maxTries": 5, "waitBetweenTries": 5000 }
        }
      },
      "id": "imagen-gen",
      "name": "4a-2. Generate Image (Imagen)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1940, 100]
    },
    {
      "parameters": {},
      "id": "clone-data",
      "name": "4a-2b. Clone Data",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [1940, 300]
    },
    {
      "parameters": { "mode": "append" },
      "id": "merge-image-data",
      "name": "4a-3. Merge",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [2160, 200]
    },
    {
      "parameters": {
        "jsCode": "const allItems = $input.all();\nconst httpResponses = allItems.filter(item => item.json.predictions !== undefined || Object.keys(item.json).length === 0);\nconst originalDataItems = allItems.filter(item => item.json.imagePrompt && item.json.sectionIndex !== undefined && !item.json.predictions);\n\nif (originalDataItems.length !== 5) throw new Error(`Expected 5 original items, got ${originalDataItems.length}`);\n\noriginalDataItems.sort((a, b) => a.json.sectionIndex - b.json.sectionIndex);\n\nconst results = [];\nfor (let i = 0; i < 5; i++) {\n  const original = originalDataItems[i];\n  const httpItem = httpResponses[i];\n  const imageBase64 = httpItem?.json?.predictions?.[0]?.bytesBase64Encoded;\n  \n  if (!imageBase64) throw new Error(`Image gen failed for ${original.json.sectionType}`);\n  \n  results.push({\n    json: {\n      sectionIndex: original.json.sectionIndex,\n      sectionType: original.json.sectionType,\n      startTime: original.json.startTime,\n      endTime: original.json.endTime,\n      duration: original.json.duration,\n      imageBase64: imageBase64,\n      _context: original.json._context || {}\n    }\n  });\n}\n\nreturn results;"
      },
      "id": "combine-images",
      "name": "4a-4. Combine Images",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2380, 200]
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst generatedImages = items.map(item => ({\n  sectionIndex: item.json.sectionIndex,\n  sectionType: item.json.sectionType,\n  startTime: item.json.startTime,\n  endTime: item.json.endTime,\n  duration: item.json.duration,\n  imageBase64: item.json.imageBase64\n}));\n\ngeneratedImages.sort((a, b) => a.sectionIndex - b.sectionIndex);\nconst context = items[0]?.json?._context || {};\n\nif (generatedImages.length !== 5) throw new Error(`Expected 5 images but got ${generatedImages.length}`);\n\nreturn { json: { ...context, generatedImages } };"
      },
      "id": "aggregate-images",
      "name": "4a-5. Aggregate Images",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2600, 200]
    },
    {
      "parameters": {
        "jsCode": "const prevContext = $input.first().json;\nconst generatedImages = prevContext.generatedImages || [];\n\nconst binaries = {};\nfor (let i = 0; i < generatedImages.length; i++) {\n  binaries[`image_${i}`] = {\n    data: generatedImages[i].imageBase64,\n    mimeType: 'image/png',\n    fileName: `section_${i}.png`\n  };\n}\n\nreturn { json: prevContext, binary: binaries };"
      },
      "id": "convert-images",
      "name": "Convert to Binary",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2820, 200]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://texttospeech.googleapis.com/v1/text:synthesize?key={{ $env.GEMINI_API_KEY }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"input\": { \"text\": \"{{ $json.script.sections.map(s => s.narration).join(' ') }}\" },\n  \"voice\": {\n    \"languageCode\": \"{{ $json.language === 'en' ? 'en-US' : ($json.language === 'ja' ? 'ja-JP' : 'ko-KR') }}\",\n    \"name\": \"{{ $json.language === 'en' ? 'en-US-Chirp3-HD-Leda' : ($json.language === 'ja' ? 'ja-JP-Chirp3-HD-Zephyr' : 'ko-KR-Chirp3-HD-Kore') }}\"\n  },\n  \"audioConfig\": { \"audioEncoding\": \"MP3\", \"sampleRateHertz\": 24000 }\n}",
        "options": {}
      },
      "id": "tts-gen",
      "name": "4b. TTS",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1500, 400]
    },
    {
      "parameters": {
        "jsCode": "const item = $input.first();\nconst prevContext = $('3. Quality Gate').first().json;\nconst audioBase64 = item.json.audioContent;\n\nif (!audioBase64) throw new Error('TTS response missing audioContent');\n\nreturn {\n  json: { ...prevContext },\n  binary: {\n    audio: {\n      data: audioBase64,\n      mimeType: 'audio/mp3',\n      fileName: 'narration.mp3'\n    }\n  }\n};"
      },
      "id": "prepare-audio",
      "name": "Prepare Audio",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2820, 400]
    },
    {
      "parameters": { "mode": "append" },
      "id": "merge-visual-audio",
      "name": "Merge Visual + Audio",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [3040, 300]
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst visualItem = items.find(i => i.binary?.image_0);\nconst audioItem = items.find(i => i.binary?.audio);\nconst jsonData = visualItem?.json || audioItem?.json || {};\n\nlet combinedBinary = {};\nfor (const item of items) {\n  if (item.binary) combinedBinary = { ...combinedBinary, ...item.binary };\n}\n\nreturn { json: jsonData, binary: combinedBinary };"
      },
      "id": "combine-binaries",
      "name": "Combine Binaries",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3260, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://compose-service:8084/api/v1/compose",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            { "parameterType": "formBinaryData", "name": "clips", "inputDataFieldName": "image_0" },
            { "parameterType": "formBinaryData", "name": "clips", "inputDataFieldName": "image_1" },
            { "parameterType": "formBinaryData", "name": "clips", "inputDataFieldName": "image_2" },
            { "parameterType": "formBinaryData", "name": "clips", "inputDataFieldName": "image_3" },
            { "parameterType": "formBinaryData", "name": "clips", "inputDataFieldName": "image_4" },
            { "parameterType": "formBinaryData", "name": "audio", "inputDataFieldName": "audio" },
            {
              "parameterType": "formData",
              "name": "metadata",
              "value": "={{ JSON.stringify({ title: $json.script.title, watermark: true, language: $json.language, clipDurations: $json.generatedImages.map(img => img.duration), subtitles: $json.script.sections.flatMap(s => s.subtitles || [{ start: s.startTime, end: s.endTime, text: s.narration }]) }) }}"
            }
          ]
        },
        "options": { "response": { "response": { "responseFormat": "file" } } }
      },
      "id": "compose",
      "name": "5. Compose (FFmpeg)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [3480, 300]
    },
    {
      "parameters": {
        "jsCode": "const item = $input.first();\nconst videoBinary = item.binary?.data;\nif (!videoBinary) throw new Error('No video binary');\n\nconst prevContext = $('Combine Binaries').first().json;\nconst jobId = prevContext.jobId;\nconst firstImage = prevContext.generatedImages?.[0];\n\nconst result = {\n  json: { ...prevContext, composedAt: new Date().toISOString() },\n  binary: { video: { ...videoBinary, fileName: 'final.mp4' } }\n};\n\nif (firstImage?.imageBase64) {\n  result.binary.thumbnail = {\n    data: firstImage.imageBase64,\n    mimeType: 'image/png',\n    fileName: 'thumbnail.png'\n  };\n}\n\nreturn result;"
      },
      "id": "process-video",
      "name": "Process Video",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3700, 300]
    },
    {
      "parameters": {
        "operation": "upload",
        "bucketName": "={{ $env.S3_BUCKET }}",
        "fileName": "=edited-videos/generated/{{ $json.jobId }}/final.mp4",
        "binaryPropertyName": "video"
      },
      "id": "s3-video",
      "name": "S3 Upload Video",
      "type": "n8n-nodes-base.awsS3",
      "typeVersion": 1,
      "position": [3920, 200],
      "credentials": { "aws": { "name": "AWS" } }
    },
    {
      "parameters": {
        "operation": "upload",
        "bucketName": "={{ $env.S3_BUCKET }}",
        "fileName": "=edited-videos/generated/{{ $json.jobId }}/thumbnail.jpg",
        "binaryPropertyName": "thumbnail"
      },
      "id": "s3-thumbnail",
      "name": "S3 Upload Thumbnail",
      "type": "n8n-nodes-base.awsS3",
      "typeVersion": 1,
      "position": [3920, 400],
      "credentials": { "aws": { "name": "AWS" } }
    },
    {
      "parameters": { "mode": "append" },
      "id": "merge-s3",
      "name": "Merge S3",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [4140, 300]
    },
    {
      "parameters": {
        "jsCode": "const prevContext = $('Process Video').first().json;\nconst s3Region = $env.AWS_REGION || 'ap-northeast-2';\nconst s3Bucket = $env.S3_BUCKET;\n\nreturn {\n  json: {\n    ...prevContext,\n    videoUrl: `https://${s3Bucket}.s3.${s3Region}.amazonaws.com/edited-videos/generated/${prevContext.jobId}/final.mp4`,\n    thumbnailUrl: `https://${s3Bucket}.s3.${s3Region}.amazonaws.com/edited-videos/generated/${prevContext.jobId}/thumbnail.jpg`\n  }\n};"
      },
      "id": "set-urls",
      "name": "Set S3 URLs",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [4360, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $env.UPVY_API_URL }}/api/v1/contents",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"title\": \"{{ $json.script.title }}\",\n  \"description\": \"{{ $json.script.description }}\",\n  \"category\": \"{{ $json.category }}\",\n  \"tags\": {{ JSON.stringify($json.script.tags) }},\n  \"language\": \"{{ $json.language }}\",\n  \"videoUrl\": \"{{ $json.videoUrl }}\",\n  \"thumbnailUrl\": \"{{ $json.thumbnailUrl }}\",\n  \"duration\": {{ $json.totalDuration || 60 }},\n  \"width\": 1080,\n  \"height\": 1920,\n  \"quiz\": {{ JSON.stringify($json.quiz) }}\n}",
        "options": {}
      },
      "id": "upvy-publish",
      "name": "6. Upvy Publish",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [4580, 300]
    },
    {
      "parameters": {
        "chatId": "={{ $env.TELEGRAM_CHAT_ID }}",
        "text": "=âœ… *AI Content Generated*\n\n*Job ID:* {{ $json.jobId }}\n*Title:* {{ $json.script.title }}\n*Language:* {{ $json.language }}\n*Category:* {{ $json.category }}\n\n*Video:* {{ $json.videoUrl }}",
        "additionalFields": { "parse_mode": "Markdown" }
      },
      "id": "telegram-success",
      "name": "Telegram Success",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [4800, 300],
      "credentials": { "telegramApi": { "name": "Telegram API" } }
    },
    {
      "parameters": {
        "chatId": "={{ $env.TELEGRAM_CHAT_ID }}",
        "text": "=âŒ *Quality Check Failed*\n\n*Reason:* {{ $json.qualityCheck?.reason || 'N/A' }}",
        "additionalFields": { "parse_mode": "Markdown" }
      },
      "id": "telegram-fail",
      "name": "Telegram Fail",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1500, 500],
      "credentials": { "telegramApi": { "name": "Telegram API" } }
    },
    {
      "parameters": {
        "jsCode": "const prevContext = $input.first().json;\nconst sections = prevContext.script.sections || [];\n\nconst items = sections.map((section, index) => {\n  const visualCue = section.visualCue || `Educational image about ${prevContext.category}`;\n  const imagePrompt = `Professional educational photograph: ${visualCue}. High-quality, photorealistic style. Clean composition, professional lighting. Vertical 9:16 format. NO cartoon, NO illustration, NO text, NO watermarks.`;\n  const motionPrompt = `Smooth cinematic motion, subtle camera movement, professional lighting. NO text overlays.`;\n  \n  return {\n    json: {\n      sectionIndex: index,\n      sectionType: section.type,\n      startTime: section.startTime,\n      endTime: section.endTime,\n      duration: section.endTime - section.startTime,\n      imagePrompt: imagePrompt,\n      motionPrompt: motionPrompt,\n      _context: prevContext\n    }\n  };\n});\n\nreturn items;"
      },
      "id": "prepare-veo",
      "name": "4c-1. Prepare Images",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1720, -100]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key={{ $env.GEMINI_API_KEY }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ instances: [{ prompt: $json.imagePrompt }], parameters: { sampleCount: 1, aspectRatio: '9:16', safetyFilterLevel: 'block_only_high', personGeneration: 'allow_adult' } }) }}",
        "options": {
          "batching": { "batch": { "batchSize": 1, "batchInterval": 5000 } },
          "retry": { "maxTries": 5, "waitBetweenTries": 5000 }
        }
      },
      "id": "veo-imagen",
      "name": "4c-2. Generate Image",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1940, -200]
    },
    {
      "parameters": {},
      "id": "veo-clone",
      "name": "4c-2b. Clone Data",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [1940, 0]
    },
    {
      "parameters": { "mode": "append" },
      "id": "veo-merge",
      "name": "4c-3. Merge",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [2160, -100]
    },
    {
      "parameters": {
        "jsCode": "const allItems = $input.all();\nconst httpResponses = allItems.filter(item => item.json.predictions !== undefined);\nconst originalDataItems = allItems.filter(item => item.json.imagePrompt && !item.json.predictions);\n\nif (originalDataItems.length !== 5) throw new Error(`Expected 5 original items, got ${originalDataItems.length}`);\n\noriginalDataItems.sort((a, b) => a.json.sectionIndex - b.json.sectionIndex);\n\nconst results = [];\nfor (let i = 0; i < 5; i++) {\n  const original = originalDataItems[i];\n  const httpItem = httpResponses[i];\n  const imageBase64 = httpItem?.json?.predictions?.[0]?.bytesBase64Encoded;\n  \n  if (!imageBase64) throw new Error(`Image gen failed for ${original.json.sectionType}`);\n  \n  results.push({\n    json: {\n      sectionIndex: original.json.sectionIndex,\n      sectionType: original.json.sectionType,\n      startTime: original.json.startTime,\n      endTime: original.json.endTime,\n      duration: original.json.duration,\n      imageBase64: imageBase64,\n      motionPrompt: original.json.motionPrompt,\n      _context: original.json._context\n    }\n  });\n}\n\nreturn results;"
      },
      "id": "veo-combine",
      "name": "4c-4. Combine Images",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2380, -100]
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst apiKey = $env.GEMINI_API_KEY;\nconst results = [];\n\nfor (const item of items) {\n  const { sectionIndex, sectionType, startTime, endTime, duration, imageBase64, motionPrompt, _context } = item.json;\n  \n  // Rate limiting: wait between requests\n  if (results.length > 0) {\n    await new Promise(r => setTimeout(r, 10000));\n  }\n  \n  const response = await this.helpers.httpRequest({\n    method: 'POST',\n    url: `https://generativelanguage.googleapis.com/v1beta/models/veo-3.1-generate-preview:predictLongRunning?key=${apiKey}`,\n    body: {\n      instances: [{\n        image: { bytesBase64Encoded: imageBase64 },\n        prompt: motionPrompt\n      }],\n      parameters: { aspectRatio: '9:16', durationSeconds: 5, sampleCount: 1 }\n    },\n    json: true\n  });\n  \n  results.push({\n    json: {\n      sectionIndex,\n      sectionType,\n      startTime,\n      endTime,\n      duration,\n      operationName: response.name,\n      _context\n    }\n  });\n}\n\nreturn results;"
      },
      "id": "veo-request",
      "name": "4c-5. Request Veo",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2600, -100]
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst apiKey = $env.GEMINI_API_KEY;\nconst maxAttempts = 120;\nconst pollInterval = 5000;\nconst results = [];\n\nfor (const item of items) {\n  const operationName = item.json.operationName;\n  if (!operationName) throw new Error('No operation name');\n  \n  let videoUri = null;\n  for (let attempt = 0; attempt < maxAttempts; attempt++) {\n    const response = await this.helpers.httpRequest({\n      method: 'GET',\n      url: `https://generativelanguage.googleapis.com/v1beta/${operationName}?key=${apiKey}`,\n      json: true\n    });\n\n    if (response.done) {\n      const videos = response.response?.generateVideoResponse?.generatedSamples || \n                     response.response?.videos || \n                     response.videos || [];\n      \n      if (videos.length === 0) {\n        throw new Error(`No videos for section ${item.json.sectionIndex}. Response: ${JSON.stringify(response).substring(0, 500)}`);\n      }\n      \n      videoUri = videos[0].video?.uri || videos[0].uri || videos[0].gcsUri;\n      if (!videoUri) throw new Error(`No URI in video: ${JSON.stringify(videos[0])}`);\n      break;\n    }\n    \n    if (response.error) throw new Error(`Veo failed: ${JSON.stringify(response.error)}`);\n    await new Promise(r => setTimeout(r, pollInterval));\n  }\n  \n  if (!videoUri) throw new Error(`Veo timeout for section ${item.json.sectionIndex}`);\n  \n  results.push({ json: { ...item.json, videoUri } });\n}\n\nreturn results;"
      },
      "id": "veo-poll",
      "name": "4c-6. Poll Veo",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2820, -100]
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst apiKey = $env.GEMINI_API_KEY;\nconst results = [];\n\nfor (const item of items) {\n  let videoUri = item.json.videoUri;\n  if (!videoUri) throw new Error('No video URI');\n  \n  // API í‚¤ ì¶”ê°€\n  const separator = videoUri.includes('?') ? '&' : '?';\n  videoUri = `${videoUri}${separator}key=${apiKey}`;\n  \n  const response = await this.helpers.httpRequest({\n    method: 'GET',\n    url: videoUri,\n    encoding: 'arraybuffer',\n    returnFullResponse: true\n  });\n  \n  results.push({\n    json: {\n      sectionIndex: item.json.sectionIndex || 0,\n      sectionType: item.json.sectionType || 'UNKNOWN',\n      duration: item.json.duration || 5,\n      videoBase64: Buffer.from(response.body).toString('base64'),\n      _context: item.json._context\n    }\n  });\n}\n\nreturn results;"
      },
      "id": "veo-download",
      "name": "4c-7. Download Veo",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3040, -100]
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst generatedVideos = items.map(item => ({\n  sectionIndex: item.json.sectionIndex,\n  sectionType: item.json.sectionType,\n  duration: item.json.duration,\n  videoBase64: item.json.videoBase64\n}));\n\ngeneratedVideos.sort((a, b) => a.sectionIndex - b.sectionIndex);\nconst context = items[0]?.json?._context || {};\n\nreturn { json: { ...context, generatedVideos, outputType: 'ai_video' } };"
      },
      "id": "veo-aggregate",
      "name": "4c-8. Aggregate Veo",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3260, -100]
    },
    {
      "parameters": {
        "jsCode": "const prevContext = $input.first().json;\nconst generatedVideos = prevContext.generatedVideos || [];\n\nconst binaries = {};\nfor (let i = 0; i < generatedVideos.length; i++) {\n  binaries[`video_${i}`] = {\n    data: generatedVideos[i].videoBase64,\n    mimeType: 'video/mp4',\n    fileName: `section_${i}.mp4`\n  };\n}\n\nreturn { json: prevContext, binary: binaries };"
      },
      "id": "convert-veo",
      "name": "Convert Veo Binary",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3480, -100]
    },
    {
      "parameters": { "mode": "append" },
      "id": "merge-veo-audio",
      "name": "Merge Veo + Audio",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [3040, 0]
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst videoItem = items.find(i => i.binary?.video_0);\nconst audioItem = items.find(i => i.binary?.audio);\nconst jsonData = videoItem?.json || audioItem?.json || {};\n\nlet combinedBinary = {};\nfor (const item of items) {\n  if (item.binary) combinedBinary = { ...combinedBinary, ...item.binary };\n}\n\nreturn { json: { ...jsonData, outputType: 'ai_video' }, binary: combinedBinary };"
      },
      "id": "combine-veo",
      "name": "Combine Veo",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3260, 0]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://compose-service:8084/api/v1/compose",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            { "parameterType": "formBinaryData", "name": "clips", "inputDataFieldName": "video_0" },
            { "parameterType": "formBinaryData", "name": "clips", "inputDataFieldName": "video_1" },
            { "parameterType": "formBinaryData", "name": "clips", "inputDataFieldName": "video_2" },
            { "parameterType": "formBinaryData", "name": "clips", "inputDataFieldName": "video_3" },
            { "parameterType": "formBinaryData", "name": "clips", "inputDataFieldName": "video_4" },
            { "parameterType": "formBinaryData", "name": "audio", "inputDataFieldName": "audio" },
            {
              "parameterType": "formData",
              "name": "metadata",
              "value": "={{ JSON.stringify({ title: $json.script.title, watermark: true, language: $json.language, clipDurations: $json.generatedVideos.map(v => v.duration), subtitles: $json.script.sections.flatMap(s => s.subtitles || []) }) }}"
            }
          ]
        },
        "options": { "response": { "response": { "responseFormat": "file" } } }
      },
      "id": "compose-veo",
      "name": "5b. Compose Veo",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [3480, 0]
    },
    {
      "parameters": {
        "jsCode": "const item = $input.first();\nconst videoBinary = item.binary?.data;\nif (!videoBinary) throw new Error('No video binary');\n\nconst prevContext = $('Combine Veo').first().json;\n\nreturn {\n  json: { ...prevContext, composedAt: new Date().toISOString() },\n  binary: { video: { ...videoBinary, fileName: 'final.mp4' } }\n};"
      },
      "id": "process-veo",
      "name": "Process Veo Video",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3700, 0]
    },
    {
      "parameters": {
        "operation": "upload",
        "bucketName": "={{ $env.S3_BUCKET }}",
        "fileName": "=edited-videos/generated/{{ $json.jobId }}/final.mp4",
        "binaryPropertyName": "video"
      },
      "id": "s3-veo",
      "name": "S3 Veo Upload",
      "type": "n8n-nodes-base.awsS3",
      "typeVersion": 1,
      "position": [3920, 0],
      "credentials": { "aws": { "name": "AWS" } }
    },
    {
      "parameters": {
        "jsCode": "const prevContext = $('Process Veo Video').first().json;\nconst s3Region = $env.AWS_REGION || 'ap-northeast-2';\nconst s3Bucket = $env.S3_BUCKET;\n\nreturn {\n  json: {\n    ...prevContext,\n    videoUrl: `https://${s3Bucket}.s3.${s3Region}.amazonaws.com/edited-videos/generated/${prevContext.jobId}/final.mp4`,\n    thumbnailUrl: `https://${s3Bucket}.s3.${s3Region}.amazonaws.com/edited-videos/generated/${prevContext.jobId}/final.mp4`\n  }\n};"
      },
      "id": "set-veo-urls",
      "name": "Set Veo URLs",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [4140, 0]
    }
  ],
  "connections": {
    "Manual Form": { "main": [[{ "node": "Set Config", "type": "main", "index": 0 }]] },
    "Schedule EN (5/day)": { "main": [[{ "node": "Set EN", "type": "main", "index": 0 }]] },
    "Schedule KO (3/day)": { "main": [[{ "node": "Set KO", "type": "main", "index": 0 }]] },
    "Schedule JA (3/day)": { "main": [[{ "node": "Set JA", "type": "main", "index": 0 }]] },
    "Set EN": { "main": [[{ "node": "Set Config", "type": "main", "index": 0 }]] },
    "Set KO": { "main": [[{ "node": "Set Config", "type": "main", "index": 0 }]] },
    "Set JA": { "main": [[{ "node": "Set Config", "type": "main", "index": 0 }]] },
    "Set Config": { "main": [[{ "node": "1. Topic Select", "type": "main", "index": 0 }]] },
    "1. Topic Select": { "main": [[{ "node": "Parse Topic", "type": "main", "index": 0 }]] },
    "Parse Topic": { "main": [[{ "node": "2. Script + Quiz Gen", "type": "main", "index": 0 }]] },
    "2. Script + Quiz Gen": { "main": [[{ "node": "Parse Script + Quiz", "type": "main", "index": 0 }]] },
    "Parse Script + Quiz": { "main": [[{ "node": "3. Quality Gate", "type": "main", "index": 0 }]] },
    "3. Quality Gate": {
      "main": [
        [{ "node": "Output Type Switch", "type": "main", "index": 0 }, { "node": "4b. TTS", "type": "main", "index": 0 }],
        [{ "node": "Telegram Fail", "type": "main", "index": 0 }]
      ]
    },
    "Output Type Switch": {
      "main": [
        [{ "node": "4c-1. Prepare Images", "type": "main", "index": 0 }],
        [{ "node": "4a. Prepare Images", "type": "main", "index": 0 }],
        [{ "node": "4a. Prepare Images", "type": "main", "index": 0 }]
      ]
    },
    "4a. Prepare Images": {
      "main": [
        [{ "node": "4a-2. Generate Image (Imagen)", "type": "main", "index": 0 }, { "node": "4a-2b. Clone Data", "type": "main", "index": 0 }]
      ]
    },
    "4a-2. Generate Image (Imagen)": { "main": [[{ "node": "4a-3. Merge", "type": "main", "index": 0 }]] },
    "4a-2b. Clone Data": { "main": [[{ "node": "4a-3. Merge", "type": "main", "index": 1 }]] },
    "4a-3. Merge": { "main": [[{ "node": "4a-4. Combine Images", "type": "main", "index": 0 }]] },
    "4a-4. Combine Images": { "main": [[{ "node": "4a-5. Aggregate Images", "type": "main", "index": 0 }]] },
    "4a-5. Aggregate Images": { "main": [[{ "node": "Convert to Binary", "type": "main", "index": 0 }]] },
    "Convert to Binary": { "main": [[{ "node": "Merge Visual + Audio", "type": "main", "index": 0 }]] },
    "4b. TTS": { "main": [[{ "node": "Prepare Audio", "type": "main", "index": 0 }]] },
    "Prepare Audio": {
      "main": [
        [{ "node": "Merge Visual + Audio", "type": "main", "index": 1 }, { "node": "Merge Veo + Audio", "type": "main", "index": 1 }]
      ]
    },
    "Merge Visual + Audio": { "main": [[{ "node": "Combine Binaries", "type": "main", "index": 0 }]] },
    "Combine Binaries": { "main": [[{ "node": "5. Compose (FFmpeg)", "type": "main", "index": 0 }]] },
    "5. Compose (FFmpeg)": { "main": [[{ "node": "Process Video", "type": "main", "index": 0 }]] },
    "Process Video": {
      "main": [
        [{ "node": "S3 Upload Video", "type": "main", "index": 0 }, { "node": "S3 Upload Thumbnail", "type": "main", "index": 0 }]
      ]
    },
    "S3 Upload Video": { "main": [[{ "node": "Merge S3", "type": "main", "index": 0 }]] },
    "S3 Upload Thumbnail": { "main": [[{ "node": "Merge S3", "type": "main", "index": 1 }]] },
    "Merge S3": { "main": [[{ "node": "Set S3 URLs", "type": "main", "index": 0 }]] },
    "Set S3 URLs": { "main": [[{ "node": "6. Upvy Publish", "type": "main", "index": 0 }]] },
    "6. Upvy Publish": { "main": [[{ "node": "Telegram Success", "type": "main", "index": 0 }]] },
    "4c-1. Prepare Images": { "main": [[{ "node": "4c-2. Generate Image", "type": "main", "index": 0 }, { "node": "4c-2b. Clone Data", "type": "main", "index": 0 }]] },
    "4c-2. Generate Image": { "main": [[{ "node": "4c-3. Merge", "type": "main", "index": 0 }]] },
    "4c-2b. Clone Data": { "main": [[{ "node": "4c-3. Merge", "type": "main", "index": 1 }]] },
    "4c-3. Merge": { "main": [[{ "node": "4c-4. Combine Images", "type": "main", "index": 0 }]] },
    "4c-4. Combine Images": { "main": [[{ "node": "4c-5. Request Veo", "type": "main", "index": 0 }]] },
    "4c-5. Request Veo": { "main": [[{ "node": "4c-6. Poll Veo", "type": "main", "index": 0 }]] },
    "4c-6. Poll Veo": { "main": [[{ "node": "4c-7. Download Veo", "type": "main", "index": 0 }]] },
    "4c-7. Download Veo": { "main": [[{ "node": "4c-8. Aggregate Veo", "type": "main", "index": 0 }]] },
    "4c-8. Aggregate Veo": { "main": [[{ "node": "Convert Veo Binary", "type": "main", "index": 0 }]] },
    "Convert Veo Binary": { "main": [[{ "node": "Merge Veo + Audio", "type": "main", "index": 0 }]] },
    "Merge Veo + Audio": { "main": [[{ "node": "Combine Veo", "type": "main", "index": 0 }]] },
    "Combine Veo": { "main": [[{ "node": "5b. Compose Veo", "type": "main", "index": 0 }]] },
    "5b. Compose Veo": { "main": [[{ "node": "Process Veo Video", "type": "main", "index": 0 }]] },
    "Process Veo Video": { "main": [[{ "node": "S3 Veo Upload", "type": "main", "index": 0 }]] },
    "S3 Veo Upload": { "main": [[{ "node": "Set Veo URLs", "type": "main", "index": 0 }]] },
    "Set Veo URLs": { "main": [[{ "node": "6. Upvy Publish", "type": "main", "index": 0 }]] }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "saveDataSuccessExecution": "all",
    "saveDataErrorExecution": "all",
    "timezone": "Asia/Seoul"
  },
  "tags": [{ "name": "ai-content" }],
  "triggerCount": 4
}
